const userId = localStorage.getItem("campusUser");
if (!userId) window.top.location.href = "login.html";

document.getElementById("saveBtn").addEventListener("click", savePersonal);

function showMessage(text, type) {
    const msg = document.getElementById("message");
    msg.innerText = text;
    msg.className = "message " + type;
    msg.style.display = "block";
}

// Load profile
async function loadProfile() {
    try {
        const response = await fetch(`http://localhost:3000/users/${userId}`);
        if (!response.ok) return;

        const user = await response.json();

        document.getElementById("first_name").value = user.first_name || "";
        document.getElementById("last_name").value = user.last_name || "";
        document.getElementById("bio").value = user.bio || "";
        document.getElementById("dob").value = user.dob || "";
        document.getElementById("gender").value = user.gender || "";
        document.getElementById("phone_number").value = user.phone_number || "";
        document.getElementById("alternate_phone").value = user.alternate_phone || "";
        document.getElementById("email_id").value = user.email_id || "";
        document.getElementById("address").value = user.address || "";
        document.getElementById("pincode").value = user.pincode || "";
        document.getElementById("city").value = user.city || "";
        document.getElementById("state").value = user.state || "";
        document.getElementById("country").value = user.country || "";

    } catch (err) {
        console.error(err);
    }
}

// Save profile
async function savePersonal() {
    // Gather only columns that exist in Users table
    const data = {
        first_name: document.getElementById("first_name").value,
        last_name: document.getElementById("last_name").value,
        email_id: document.getElementById("email_id").value,
        phone_number: document.getElementById("phone_number").value,
        alternate_phone: document.getElementById("alternate_phone").value,
        bio: document.getElementById("bio").value,
        dob: document.getElementById("dob").value,
        gender: document.getElementById("gender").value
    };

    try {
        const response = await fetch(`http://localhost:3000/users/${userId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        if (!response.ok) throw new Error(`Status: ${response.status}`);
        showMessage("Profile saved successfully!", "success");

    } catch (err) {
        console.error(err);
        showMessage("Error saving profile", "error");
    }
}

// Load profile on page load
loadProfile();


